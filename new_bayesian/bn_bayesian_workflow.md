# bn_bayesian.py å·¥ä½œæµç¨‹è¯¦è§£

## ğŸ“‹ å®Œæ•´æ‰§è¡Œé“¾è·¯

```
å¼€å§‹
  â†“
1. åˆå§‹åŒ– BayesianNetworkBayesian å¯¹è±¡
  â”œâ”€ è®¾ç½®æ•°æ®è·¯å¾„: ../dataset/data_info/training_dataset.csv
  â”œâ”€ è®¾ç½®è§„åˆ™è·¯å¾„: ../dataset/optimal_rules.csv
  â””â”€ åˆ›å»ºè¾“å‡ºç›®å½•: ../pkl, ../bayesian_result
  â†“
2. load_data() - åŠ è½½è®­ç»ƒæ•°æ®
  â”œâ”€ è¯»å– CSV æ–‡ä»¶
  â”œâ”€ éªŒè¯æ•°æ®å®Œæ•´æ€§
  â””â”€ è¾“å‡º: 10ä¸‡æ¡è®°å½•ï¼Œ7ä¸ªç‰¹å¾
  â†“
3. preprocess_data() - æ•°æ®é¢„å¤„ç†
  â”œâ”€ ä¿ç•™å…³é”®åˆ—: department, temp, vibration, oil_pressure, voltage, rpm, æ•…éšœç±»å‹
  â”œâ”€ è¿ç»­å˜é‡ç¦»æ•£åŒ– (åŸºäºæ ‡å‡†å·®åˆ†ç®±)
  â”‚   â”œâ”€ temp â†’ [æä½æ¸©, ä½æ¸©, ä¸­æ¸©, é«˜æ¸©, æé«˜æ¸©]
  â”‚   â”œâ”€ vibration â†’ [æä½æŒ¯åŠ¨, ä½æŒ¯åŠ¨, ä¸­æŒ¯åŠ¨, é«˜æŒ¯åŠ¨, æé«˜æŒ¯åŠ¨]
  â”‚   â”œâ”€ oil_pressure â†’ [æä½æ²¹å‹, ä½æ²¹å‹, ä¸­æ²¹å‹, é«˜æ²¹å‹, æé«˜æ²¹å‹]
  â”‚   â”œâ”€ voltage â†’ [æä½ç”µåŠ›, ä½ç”µåŠ›, ä¸­ç”µåŠ›, é«˜ç”µåŠ›, æé«˜ç”µåŠ›]
  â”‚   â””â”€ rpm â†’ [æä½è½¬é€Ÿ, ä½è½¬é€Ÿ, ä¸­è½¬é€Ÿ, é«˜è½¬é€Ÿ, æé«˜è½¬é€Ÿ]
  â””â”€ éƒ¨é—¨å˜é‡å¤„ç†: department â†’ éƒ¨é—¨_ç”Ÿäº§éƒ¨, éƒ¨é—¨_ç ”å‘éƒ¨...
  â†“
4. load_rules() - åŠ è½½å…³è”è§„åˆ™
  â”œâ”€ è¯»å– optimal_rules.csv
  â””â”€ è¾“å‡º: 4æ¡ä¼˜åŒ–è§„åˆ™
  â†“
5. process_rules() - å¤„ç†è§„åˆ™æ„å»ºç½‘ç»œç»“æ„
  â”œâ”€ è§£æè§„åˆ™æ ¼å¼: "å‰å›  â†’ åæœ"
  â”‚   ä¾‹: "ä¸­ç”µåŠ› âˆ§ æé«˜è½¬é€Ÿ â†’ ä¼ åŠ¨ç³»ç»Ÿå¼‚å¸¸"
  â”œâ”€ æå–å‰å› æ¡ä»¶ (ç”¨ âˆ§ åˆ†å‰²)
  â”œâ”€ æ˜ å°„çŠ¶æ€å€¼åˆ°å˜é‡å
  â”‚   ä¾‹: "ä¸­ç”µåŠ›" â†’ voltage
  â”‚        "æé«˜è½¬é€Ÿ" â†’ rpm
  â””â”€ æ„å»ºè¾¹: (å˜é‡å, 'æ•…éšœç±»å‹')
      ä¾‹: (voltage, 'æ•…éšœç±»å‹'), (rpm, 'æ•…éšœç±»å‹')
  â†“
6. build_network() - æ„å»ºè´å¶æ–¯ç½‘ç»œ
  â”œâ”€ ä½¿ç”¨ pgmpy.BayesianNetwork
  â”œâ”€ è¾“å…¥ç½‘ç»œç»“æ„ (è¾¹çš„åˆ—è¡¨)
  â””â”€ åˆ›å»ºæœ‰å‘æ— ç¯å›¾ (DAG)
  â†“
7. visualize_network() - å¯è§†åŒ–ç½‘ç»œç»“æ„
  â”œâ”€ ä½¿ç”¨ networkx ç»˜åˆ¶ç½‘ç»œå›¾
  â”œâ”€ ä¿å­˜å›¾ç‰‡: ../bayesian_result/network_structure.png
  â””â”€ æ˜¾ç¤ºèŠ‚ç‚¹å’Œè¾¹çš„å…³ç³»
  â†“
8. estimate_parameters() - è´å¶æ–¯å‚æ•°ä¼°è®¡ â­æ ¸å¿ƒæ­¥éª¤
  â”œâ”€ éªŒè¯æ•°æ®åˆ—ä¸æ¨¡å‹èŠ‚ç‚¹åŒ¹é…
  â”œâ”€ ä½¿ç”¨ BayesianEstimator ä¼°è®¡æ¡ä»¶æ¦‚ç‡è¡¨ (CPD)
  â”œâ”€ å°† CPD æ·»åŠ åˆ°æ¨¡å‹
  â”œâ”€ ä¿å­˜æ¨¡å‹: ../pkl/bn_bayesian_model.pkl
  â”œâ”€ æ¨¡å‹é¢„æµ‹ (åœ¨è®­ç»ƒé›†ä¸ŠéªŒè¯)
  â”œâ”€ ç”Ÿæˆåˆ†ç±»æŠ¥å‘Š: ../bayesian_result/classification_report.txt
  â””â”€ ç»˜åˆ¶æ··æ·†çŸ©é˜µ: ../bayesian_result/confusion_matrix.png
  â†“
ç»“æŸ - è¾“å‡ºæ€»è¿è¡Œæ—¶é—´
```

---

## ğŸ” è¯¦ç»†æ­¥éª¤è¯´æ˜

### Step 1: åˆå§‹åŒ–
```python
bn = BayesianNetworkBayesian(data_path, rules_path)
```
- è®¾ç½®åˆ†ç®±é…ç½® (5ä¸ªç­‰çº§)
- å®šä¹‰å˜é‡æ˜ å°„å…³ç³»
- åˆ›å»ºå¿…è¦çš„è¾“å‡ºç›®å½•

### Step 2: åŠ è½½æ•°æ®
```python
bn.load_data()
```
**è¾“å…¥**: `../dataset/data_info/training_dataset.csv`
**è¾“å‡º**: DataFrame (100,000 Ã— 7)

### Step 3: æ•°æ®é¢„å¤„ç†
```python
bn.preprocess_data()
```
**å…³é”®æ“ä½œ**: 
- åŸºäºæ ‡å‡†å·®çš„åˆ†ç®±: `bins = [min, mean-2Ïƒ, mean-Ïƒ, mean+Ïƒ, mean+2Ïƒ, max]`
- è½¬æ¢ä¸ºç±»åˆ«å˜é‡

### Step 4-5: è§„åˆ™å¤„ç†
```python
bn.load_rules()
bn.process_rules()
```
**è¾“å…¥**: `../dataset/optimal_rules.csv`
**è¾“å‡º**: ç½‘ç»œç»“æ„è¾¹åˆ—è¡¨
```python
[
    ('voltage', 'æ•…éšœç±»å‹'),
    ('rpm', 'æ•…éšœç±»å‹'),
    ('vibration', 'æ•…éšœç±»å‹'),
    ('temp', 'æ•…éšœç±»å‹'),
    ('oil_pressure', 'æ•…éšœç±»å‹'),
    ('department', 'æ•…éšœç±»å‹')
]
```

### Step 6: æ„å»ºç½‘ç»œ
```python
bn.build_network()
```
åˆ›å»ºè´å¶æ–¯ç½‘ç»œ DAGï¼Œæ‰€æœ‰ç‰¹å¾æŒ‡å‘æ•…éšœç±»å‹

### Step 7: å¯è§†åŒ–
```python
bn.visualize_network(save_path="../bayesian_result/network_structure.png")
```
ç”Ÿæˆç½‘ç»œç»“æ„å›¾

### Step 8: å‚æ•°ä¼°è®¡ â­
```python
bn.estimate_parameters()
```
**æ ¸å¿ƒç®—æ³•**: è´å¶æ–¯ä¼°è®¡
- è®¡ç®—æ¡ä»¶æ¦‚ç‡è¡¨ P(ç‰¹å¾|æ•…éšœç±»å‹)
- ä½¿ç”¨å…ˆéªŒåˆ†å¸ƒå¹³æ»‘
- ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹

---

## ğŸ“¤ è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `../pkl/bn_bayesian_model.pkl` | è®­ç»ƒå¥½çš„è´å¶æ–¯ç½‘ç»œæ¨¡å‹ |
| `../bayesian_result/network_structure.png` | ç½‘ç»œç»“æ„å¯è§†åŒ–å›¾ |
| `../bayesian_result/classification_report.txt` | åˆ†ç±»æ€§èƒ½æŠ¥å‘Š |
| `../bayesian_result/confusion_matrix.png` | æ··æ·†çŸ©é˜µçƒ­åŠ›å›¾ |

---

## ğŸ¯ å…³é”®ä»£ç ç‰‡æ®µ

### è´å¶æ–¯ä¼°è®¡æ ¸å¿ƒä»£ç 
```python
# åˆ›å»ºè´å¶æ–¯ä¼°è®¡å™¨
bayesian_estimator = BayesianEstimator(self.model, self.processed_data)

# ä¼°è®¡æ‰€æœ‰èŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡è¡¨
cpd_list = bayesian_estimator.get_parameters()

# å°† CPD æ·»åŠ åˆ°æ¨¡å‹
self.model.add_cpds(*cpd_list)

# é¢„æµ‹
y_pred = self.model.predict(predict_data)[['æ•…éšœç±»å‹']].values.flatten()
```

---

## â±ï¸ æ€§èƒ½æŒ‡æ ‡

- **æ•°æ®åŠ è½½**: ~1ç§’
- **æ•°æ®é¢„å¤„ç†**: ~2ç§’
- **è§„åˆ™å¤„ç†**: <1ç§’
- **ç½‘ç»œæ„å»º**: <1ç§’
- **å‚æ•°ä¼°è®¡**: ~5-10ç§’
- **æ€»è¿è¡Œæ—¶é—´**: ~10-15ç§’

---

## ğŸ”„ ä¸åç»­æµç¨‹çš„è¡”æ¥

è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨ `predict/predict.py`:
```python
# åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹
model = pickle.load('bn_bayesian_model.pkl')

# å¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹
predictions = model.predict(new_data)
```
